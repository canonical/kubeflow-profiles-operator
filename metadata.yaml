# Copyright 2023 Canonical Ltd.
# See LICENSE file for licensing details.
name: kubeflow-profiles
summary: Kubeflow Profiles and Access Management
description: Kubeflow Profiles and Access Management
website: https://charmhub.io/kubeflow-profiles
source: https://github.com/canonical/kubeflow-profiles-operator
issues: https://github.com/canonical/kubeflow-profiles-operator/issues
docs: https://discourse.charmhub.io/t/charmed-kubeflow-profiles/8232
containers:
  kubeflow-profiles:
    resource: profile-image
    uid: 584792
    gid: 584792
    mounts:
    - storage: config-profiles
      location: /etc/profile-controller
  kubeflow-kfam:
    resource: kfam-image
    uid: 584792
    gid: 584792
resources:
  profile-image:
    type: oci-image
    description: Profile controller image
    auto-fetch: true
    # TODO: Replace image with upstream image or rock
    # once https://github.com/kubeflow/dashboard/pull/127 is merged
    upstream-source: docker.io/charmedkubeflow/profile-controller:1.10.0-06ad3c6
  kfam-image:
    type: oci-image
    description: Access Management image
    auto-fetch: true
    upstream-source: docker.io/charmedkubeflow/kfam:1.10.0-7fcf726
provides:
  provide-cmr-mesh:
    interface: cross_model_mesh
    description: |
      If this app is generating polciies to provide access to related applications that are cross-model, relate that app to this additional relation to retrieve additional data required for these policies.  This is required because Juju does not natively provide all information required to build these policies when related cross-model.
  kubeflow-profiles:
    interface: k8s-service
    schema:
      v1:
        provides:
          type: object
          properties:
            service-name:
              type: string
            service-port:
              type: string
          required:
          - service-name
          - service-port
    versions: [v1]
    __schema_source: https://raw.githubusercontent.com/canonical/operator-schemas/master/k8s-service.yaml
  metrics-endpoint:
    interface: prometheus_scrape
  profiles-backup-config:
    interface: velero_backup_config
  user-workloads-backup-config:
    interface: velero_backup_config
requires:
  logging:
    interface: loki_push_api
    optional: true
  ingress:
    interface: ingress
    limit: 1
    optional: true
    description: |
      Integrate this charm with Istio using sidecar mode
  service-mesh:
    limit: 1
    interface: service_mesh
    description: |
      Integrate this charm into a service mesh
  require-cmr-mesh:
    interface: cross_model_mesh
    description: |
      If this app relates to other applications on a charmed service mesh cross-model, use this relation to send that related app additional data needed to automatically generate traffic authorization policies.  This is required because Juju does not natively provide all information required to build these policies when related cross-model.
storage:
  config-profiles:
    type: filesystem
    minimum-size: 1M
charm-user: non-root
